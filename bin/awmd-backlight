#!/bin/bash

CMD=$1
OPT=$2
CURRENTF=`xbacklight`
CURRENT=${CURRENTF%.*}
SLOWTHRESHOLD=5
MODE="change"

if (( $CURRENT <= $SLOWTHRESHOLD )); then
    PRC="1%"
else
    PRC="5%"
fi

case $CMD in
    up)
        xbacklight -inc "$PRC";;
    down)
        if (( $CURRENT > $SLOWTHRESHOLD )); then
            NEWCURRENT=`bc -l <<< "$CURRENT-$SLOWTHRESHOLD"`
            echo $NEWCURRENT
            if (( $NEWCURRENT <= $SLOWTHRESHOLD )); then
                xbacklight -set $SLOWTHRESHOLD -time 1
            else
                xbacklight -dec "$PRC" -time 1
            fi
        else
            xbacklight -dec "$PRC" -time 1
        fi
        ;;
    set)
        xbacklight -set $OPT -time 1
        xbacklight
        ;;
    get)
        ;;
    *)
        ;;
esac

VAL=`xbacklight`

case $OPT in
    quiet)
        ;;
    *)
        `dirname "$0"`/awmd-osd --pos="bottom" --align="center" --delay=2 --colour=white --barmode=percentage --text="Brightness" --percentage="$VAL"
        ;;
esac

echo $VAL
